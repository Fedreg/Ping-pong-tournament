var App,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};App=function(){function App(){this.writeTournamentsWon=bind(this.writeTournamentsWon,this);this.writeGamesWon=bind(this.writeGamesWon,this);this.getPlayers=bind(this.getPlayers,this);this.startTournament=bind(this.startTournament,this);this.increment=bind(this.increment,this);this.players=ko.observableArray([]);this.getPlayers();this.roundNumber=ko.observable(1);this.semiFinalists=ko.observableArray([]);this.finalists=ko.observableArray([]);this.champion=ko.observable();this.positions=ko.observable(false);this.gameStarted=ko.observable(false);this.tournamentWins=ko.observable();console.log(this.players());this.whichRound=ko.computed(function(_this){return function(){if(_this.semiFinalists().length===4){_this.roundNumber(2)}if(_this.finalists().length===2){return _this.roundNumber(3)}}}(this));this.winners=ko.computed(function(_this){return function(){var k,l,len,len1,len2,m,newPlayer,player,ref,ref1,ref2,results;if(_this.roundNumber()===1){ref=_this.players();for(k=0,len=ref.length;k<len;k++){player=ref[k];newPlayer={name:player.name,wins:ko.observable(0),id:player.id,tournaments_won:player.tournaments_won,matches_played:ko.observable(player.matches_played())};if(player.wins()===3){_this.semiFinalists().push(newPlayer);player.wins("Winner!");_this.semiFinalists(_this.semiFinalists())}}}if(_this.roundNumber()===2){ref1=_this.semiFinalists();for(l=0,len1=ref1.length;l<len1;l++){player=ref1[l];newPlayer={name:player.name,wins:ko.observable(0),id:player.id,tournaments_won:player.tournaments_won,matches_played:ko.observable(player.matches_played())};if(player.wins()===3){_this.finalists().push(newPlayer);player.wins("Winner!");_this.finalists(_this.finalists())}}}if(_this.roundNumber()===3){ref2=_this.finalists();results=[];for(m=0,len2=ref2.length;m<len2;m++){player=ref2[m];newPlayer={name:player.name,wins:ko.observable(0),id:player.id,tournaments_won:player.tournaments_won,matches_played:ko.observable(player.matches_played())};if(player.wins()===3){_this.champion(newPlayer.name);player.wins("Winner!");_this.writeTournamentsWon(newPlayer);results.push(_this.champion(_this.champion()))}else{results.push(void 0)}}return results}}}(this))}App.prototype.increment=function(player){player.wins(player.wins()+1);player.matches_played(player.matches_played()+1);this.writeGamesWon(player);console.log("Player: ",player.name);return console.log("Wins: ",player.matches_played())};App.prototype.startTournament=function(){var arr,i,j,tempi,tempj;arr=this.players();i=arr.length;while(--i){j=Math.floor(Math.random()*(i+1));tempi=arr[i];tempj=arr[j];arr[i]=tempj;arr[j]=tempi}this.players(arr);this.positions(true);return this.gameStarted(true)};App.prototype.getPlayers=function(){var horizon,players;horizon=Horizon();horizon.connect();players=horizon("players");return players.fetch().subscribe(function(_this){return function(items){var item,k,len,results;results=[];for(k=0,len=items.length;k<len;k++){item=items[k];item.wins=ko.observable(item.wins);item.matches_played=ko.observable(item.matches_played);_this.players().push(item);results.push(_this.players(_this.players()))}return results}}(this),function(_this){return function(err){return console.log(err)}}(this))};App.prototype.writeGamesWon=function(player){var horizon,newVal,players;horizon=Horizon();horizon.connect();players=horizon("players");newVal=player.matches_played()+1;return players.update({id:player.id,matches_played:newVal})};App.prototype.writeTournamentsWon=function(player){var horizon,newVal,players;horizon=Horizon();horizon.connect();players=horizon("players");newVal=player.tournaments_won+1;return players.update({id:player.id,tournaments_won:newVal})};return App}();ko.applyBindings(new App);