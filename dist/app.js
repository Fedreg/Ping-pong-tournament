var App,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};App=function(){function App(){this.getAllTimeStats=bind(this.getAllTimeStats,this);this.writeGameStats=bind(this.writeGameStats,this);this.getPlayers=bind(this.getPlayers,this);this.startTournament=bind(this.startTournament,this);this.increment=bind(this.increment,this);this.players=ko.observableArray([]);this.getPlayers();this.roundNumber=ko.observable(1);this.semiFinalists=ko.observableArray([]);this.finalists=ko.observableArray([]);this.champion=ko.observable();this.positions=ko.observable(false);this.gameStarted=ko.observable(false);this.whichRound=ko.computed(function(_this){return function(){if(_this.semiFinalists().length===4){_this.roundNumber(2)}if(_this.finalists().length===2){return _this.roundNumber(3)}}}(this));this.winners=ko.computed(function(_this){return function(){var k,l,len,len1,len2,m,newPlayer,player,ref,ref1,ref2,results;if(_this.roundNumber()===1){ref=_this.players();for(k=0,len=ref.length;k<len;k++){player=ref[k];newPlayer={name:player.name,wins:ko.observable(0),id:player.id};if(player.wins()===3){_this.semiFinalists().push(newPlayer);player.wins("Winner!");_this.semiFinalists(_this.semiFinalists())}}}if(_this.roundNumber()===2){ref1=_this.semiFinalists();for(l=0,len1=ref1.length;l<len1;l++){player=ref1[l];newPlayer={name:player.name,wins:ko.observable(0),id:player.id};if(player.wins()===3){_this.finalists().push(newPlayer);player.wins("Winner!");_this.finalists(_this.finalists())}}}if(_this.roundNumber()===3){ref2=_this.finalists();results=[];for(m=0,len2=ref2.length;m<len2;m++){player=ref2[m];newPlayer={name:player.name,wins:ko.observable(0),id:player.id};if(player.wins()===3){_this.champion(newPlayer.name);player.wins("Winner!");_this.writeGameStats(newPlayer);results.push(_this.champion(_this.champion()))}else{results.push(void 0)}}return results}}}(this))}App.prototype.increment=function(player){return player.wins(player.wins()+1)};App.prototype.startTournament=function(){var arr,i,j,tempi,tempj;arr=this.players();i=arr.length;while(--i){j=Math.floor(Math.random()*(i+1));tempi=arr[i];tempj=arr[j];arr[i]=tempj;arr[j]=tempi}this.players(arr);this.positions(true);return this.gameStarted(true)};App.prototype.getPlayers=function(){var horizon,players;horizon=Horizon();horizon.connect();players=horizon("players");players.fetch().subscribe(function(_this){return function(items){var item,k,len,results;results=[];for(k=0,len=items.length;k<len;k++){item=items[k];item.wins=ko.observable(item.wins);_this.players().push(item);_this.players(_this.players());results.push(console.log(item))}return results}}(this),function(_this){return function(err){return console.log(err)}}(this));return console.log("Players: ",this.players())};App.prototype.writeGameStats=function(player){var horizon,players;horizon=Horizon();horizon.connect();players=horizon("players");return players.update({id:player.id,tournaments_won:parseInt(player.tournaments_won)+1})};App.prototype.getAllTimeStats=function(){};return App}();ko.applyBindings(new App);